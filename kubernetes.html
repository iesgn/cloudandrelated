---
layout: presentacion
title: ¿Qué nos aporta Kubernetes en el despliegue de aplicaciones?
tema: white
---
<section>
  <h2>¿Qué nos aporta Kubernetes en el despliegue de aplicaciones?</h2>
    <p>
    Alberto Molina Coballes, José Luis Rodríguez Rodríguez and José Domingo Muñoz Rodríguez
  </p>
  <p><small>Cloud Computing in European schools. Project: 2017-1-ES01-KA202-038471</small></p>
  <p><img src="img/UE.png" width="250px" border="0"/>
    <img src="img/iesvalleinclan.png" width="250px" border="0"/>
  </p>
  <p>
    <a href="http://creativecommons.org/licenses/by-sa/3.0/">
      <img src="img/cc_by_sa.png" width="100px" border="0"/></a>
  </p>
  <p><small>Theme by: <a href="http://lab.hakim.se/reveal-js/#/">reveal.js</a></small></p>
</section>

<section>
  <h3>Kubernetes</h3>
  <p>Kubernetes es un orquestador de contenedores de aplicación escrito en Go y con licencia Apache-2.0, fue lanzado el 21 de julio de 2015 por Google que rápidamente se alió con la Linux Foundation para crear la Cloud Native Computing Foundation (CNCF) y dejó el proyecto en sus manos. </p>
  <p>Gestionamos un cluster:</p>
  <pre><code>
kubectl get nodes
NAME     STATUS   ROLES    AGE     VERSION
nodo-1   Ready    master   2m32s   v1.12.2
nodo-2   Ready    &lt;none&gt;   42s     v1.12.2
nodo-3   Ready    &lt;none&gt;   42s     v1.12.2
 </code></pre>
</section>
<section>
<section>
  <h3>Recursos de Kubernetes</h3>
  <img src="img/kubernetes1.png"/>
</section>
<section>
  <h3>¿Qué nos aportan cada uno de los recursos de Kubernetes? (I)</h3>
  <ul>
    <li><strong>Pods</strong>: La unidad mínima de computación, permite ejecutar contenedores. Representa un conjunto de contenedores y almacenamiento compartido que comparte una única IP.</li>
    <li><strong>ReplicaSet</strong>: Asegura que siempre se ejecute un número de replicas de un pod determinado. Nos proporciona las siguientes características:
      <ul>
        <li>Que no haya caída del servicio</li>
        <li>Tolerancia a errores</li>
        <li>Escabilidad dinámica</li>
      </ul>
  </li>
  </ul>
</section>
<section>
  <h3>¿Qué nos aportan cada uno de los recursos de Kubernetes? (II)</h3>
  <ul>
    <li><strong>Deployment</strong>: Nos permite manejar los <em>ReplicaSets</em>. Nos proporciona las siguientes características:
      <ul>
        <li>Actualizaciones continúas</li>
        <li>Despliegues automáticos</li>
      </ul>
  </li>
  <li>
    <strong>Service</strong>: Nos permite el acceso a los pod.
  </li>
  <li>
    <strong>Ingress</strong>: Nos permite implementar un proxy inverso para el acceso a los distintos servicios establecidos. Estos dos elementos nos proporcionan la siguiente funcionalidad:
    <ul>
      <li>Balanceo de carga</li>
    </ul>
  </li>
  </ul>
</section>
<section>
  <h3>¿Qué nos aportan cada uno de los recursos de Kubernetes? (III)</h3>
  <ul>
    <li>Otros recursos de un cluster Kubernetes nos pueden proporcional características adicionales:
    <ul>
      <li>Migraciones sencillas</li>
      <li>Monitorización</li>
      <li>Control de acceso basada en Roles</li>
      <li>Integración y despliegue continuo</li>
    </ul>
  </li>
  </ul>
</section>
</section>
<section>
<section>
  <h3>Ejemplo: Tolerancia a fallos</h3>
</section>
<section>
  <ul><li>Creamos un despliegue a partir de la imagen <code>josedom24/aplicacionweb:v1</code></li></ul>
    <pre><code>
kubectl run pagweb --image josedom24/aplicacionweb:v1
    </code></pre><br/>
  <ul><li>Comprobamos que se ha creado un pod:</li></ul>
<pre><code>
kubectl get pod
NAME                     READY   STATUS    RESTARTS   AGE
pagweb-5d756cb86-wm4zg   1/1     Running   0          3m7s
</code></pre>
</section>
<section>
<ul><li>Si por cualquier motivo el pod deja de funcionar, comprobamos que Kubernetes vuelve a crear un nuevo pod:</li></ul>    
<pre><code>
kubectl delete pod/pagweb-5d756cb86-wm4zg
pod "pagweb-5d756cb86-wm4zg" deleted

kubectl get pod
NAME                     READY   STATUS        RESTARTS   AGE
pagweb-5d756cb86-2w2xq   1/1     Running       0          21s
pagweb-5d756cb86-wm4zg   1/1     Terminating   0          4m56s
</code></pre>
</section>
<section>
<ul><li>Además del pod se ha creado un recurso Deployment y otro ReplicaSet:</li></ul>
<pre><code>
kubectl get deploy
NAME     DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE
pagweb   1         1         1            1           5m

kubectl get rs
NAME               DESIRED   CURRENT   READY   AGE
pagweb-5d756cb86   1         1         1       5m
</code></pre>
<ul><li>El recurso ReplicaSet es el responsable de este funcionamiento.</li></ul>
</section>
</section>
<section>
<section>
  <h3>Ejemplo: Escabilidad</h3>
</section>
<section>
  <ul><li>ReplicaSet también es el responsable de las replicas. En cualquier podemos escalar el número de pods:</li></ul>
<pre><code>
kubectl scale deploy pagweb --replicas=3
deployment.extensions/pagweb scaled
</code></pre>
<ul><li>Y podemos comprobar que se han creado 3 pods ejecutándose en distintos nodos:</li></ul>
<pre><code>
kubectl get pod -o wide
NAME                     READY   STATUS    RESTARTS   AGE   IP          NODE     NOMINATED NODE
pagweb-5d756cb86-2w2xq   1/1     Running   0          7m   10.42.0.2   nodo-2   <none>
pagweb-5d756cb86-gwfgf   1/1     Running   0          17s   10.36.0.1   nodo-3   <none>
pagweb-5d756cb86-wppxj   1/1     Running   0          17s   10.36.0.2   nodo-3   <none>
</code></pre>
</section>
</section>
<section>
<section>
    <h3>Ejemplo: Accediendo a nuestra aplicación. Balanceo de carga</h3>
</section>
<section>
  <ul><li>Para acceder a nuestra aplicación debemos crear un recurso Service:</li></ul>
  <pre><code>
kubectl expose deployment pagweb --port=80 --type=NodePort
service/pagweb exposed

kubectl get services
NAME         TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)        AGE
...
pagweb       NodePort    10.98.140.134   <none>        80:30848/TCP   18s
</code></pre>
</section>
<section>
  <ul><li>Podemos acceder a la IP del nodo master, al puerto 30848:</li></ul>
  <img src="img/kubernetes2.png"></img>
  <ul><li>Cada vez que accedemos a la aplicación se está accediendo a uno de los 3 pods que hemos creado. (Balanceo de carga)</li></ul>
</section>
</section>
<section>
  <h3>Ejemplo: Actualizaciones continúas</h3>
</section>
<section>
  <h3>Ejemplo: Rollback de nuestra aplicación</h3>
</section>
<section>
  <h3>Ejemplo: Accediendo a nuestra aplicación</h3>
</section>
<section>
  <h3>Ejemplo: Enrutando nuestras aplicaciones.</h3>
</section>
<section>
  <h3>Ejemplo: Volúmenes persistentes en Kubernetes</h3>
</section>
