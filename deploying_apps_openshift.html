---
layout: presentacion
title: Deploying applications on OpenShift
tema: white
---
<section>
  <h2>Deploying applications on OpenShift</h2>
  <p>
    Alberto Molina Coballes, José Luis Rodríguez Rodríguez and José Domingo Muñoz Rodríguez
  </p>
  <p><small>Cloud Computing in European schools. Project: 2017-1-ES01-KA202-038471</small></p>
  <p><img src="img/UE.png" width="250px" border="0"/>
    <img src="img/iesvalleinclan.png" width="250px" border="0"/>
  </p>
  <p>
    <a href="http://creativecommons.org/licenses/by-sa/3.0/">
      <img src="img/cc_by_sa.png" width="100px" border="0"/></a>
  </p>
  <p><small>Theme by: <a href="http://lab.hakim.se/reveal-js/#/">reveal.js</a></small></p>
</section>
<section>
<section>
  <h3>OpenShift v3</h3>
</section>
<section>
  <h4>OpenShift v3</h4>
  <ul>
    <li>It simplifies the implementation life cycle of our applications
      offered by Docker.</li>
    <li>The developer only has to focus on the development of the
      application.</li>
    <li>The project will be stored in a git repository.</li>
    <li>When deploying the application, OpenShift will read the source
      code from the repository and a new docker image is created on
      the fly</li>
    <li><strong><a href="https://docs.openshift.com/container-platform/3.11/architecture/core_concepts/builds_and_image_streams.html#source-build">source2image</a></strong></li>
    </ul>
  </ul>
</section>
<section>
  <h4>OpenShift v3</h4>
  <ul>
    <li>It offers us all the advantages of using Kubernetes:
      <ul>
	<li>Error tolerance</li>
	<li>Dynamic Scalability</li>
	<li>Continuous updates</li>
	<li>Automatic deployments</li>
	<li>Routing to the applications</li>
	<li>Load balancing</li>
	<li>Persistent volumes</li>
      </ul>
    <li>But also...</li>
  </ul>
</section>
<section>
  <h4>OpenShift v3</h4>
    <ul>
      <li>Easier management of projects and users</li>
      <li>A set of base images for different programming languages and
	databases</li>
      <li>Automatic name assignment for the applications (resource
	service and ingress controller)</li>
      <li>Easier volume management</li>
      <li>Integrated IC/CD flows</li>
      <li>Metric and monitoring tools</li>
    </ul>
</section>
</section>
<section>
<section>
  <h4>OpenShift resources</h4>
  <ul>
    <li><strong>Projects</strong>: They allow users to organize and
    control their applications.</li>
    <li><strong>Application</strong>: Our applications are a
    kubernetes applications, so they are formed by different
      resources: deployment, pods, service, routes</li>
    <li><strong>Builds</strong>: It's the process used to create the
    image. There are different strategies:</li>
    <ul>
      <li>From an image, from a Dockerfile, ...</li>
      <li>source2image</li>
      <li>Jenkins' pipeline</li>
      <li>...</li>
    </ul>
  </ul>
</section>
<section>
  <h4>Recursos que nos ofrece OpenShift</h4>
  <ul>
      <li><strong>image registry</strong>: The images created in the builds are saved in an internal registry</li>
      <li><strong>Routes</strong>: A route (name) is automatically associated to access each application</li>
      <li><strong>Service catalog</strong>: Set of images and base
      templates. New images can be built from them using s2i.</li>
      <li><strong>Web Console</strong></li>
      <li><strong>cli oc</strong>: Command line tool to manage OpenShift</li>
  </ul>
</section>
</section>
<section>
<section>
  <h4>Creating the first application</h4>
  <ul>
    <li> Let's create a static web application with an apache2 web
      server.</li>
    <li>Our page is in a GitHub repository.</li>
    <li>We are going to create our application using source2image:
    when we create the application we are going to choose an image
    with apache2 and we are going to indicate our repository with the
    code: A docker image with apache2 is selected and the repository
    is used to deploy the application</li>
  </ul>
</section>
<section>
  <h4>Creating the first application</h4>
  <ol>
    <li>From the catalog we chose the image of apache2</li>
    <li>We indicate a name and the repository where the code is
      located</li>
    <li>A build is created:
      <ul>
	<li>A pod is created from the selected apache2 image.</li>
	<li>The repository code is injected into that pod.</li>
	<li>A new image is created with apache2 and our
	  application.</li>
      </ul>
    </li>
  </ol>
</section>
<section>
  <h4>Creamos nuestra primera aplicación</h4>
  <ol start="4">
    <li>From the new image:</li>
    <ul>
      <li>A deployment is created that creates a pod with the
        application.</li>
      <li>An access service to the application is created.</li>
      <li>An access route is created.</li>
    </ul>
    <li>The applications is already deployed and we can access it</li>
  </ol>
</section>
<section>
  <h3>Demo1: static content deployment on OpenShift v3</h3>
  <iframe width="560" height="315" src="https://www.youtube.com/embed/n938MmkxJWA" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>

</section>
</section>
<section>
<section>
  <h4>Actualización y rollback de nuestra aplicación</h4>
  <ol>
    <li>Modificamos el código de nuestra aplicación, y guardamos los cambios en el repositorio.</li>
    <li>Desde openshift realizamos un nuevo build, que construye una nueva imagen con la aplicación modificada.</li>
    <li>A continuación, de forma automática, se realizará un nuevo deployment, que borrará los pods antiguos y creará nuevos desde la nueva imagen.</li>
    <li>En cualquier momento podemos desplegar un deployment anterior, para volver a una versión anterior de nuestra aplicación.</li>
  </ol>
</section>
<section>
  <h4>Actualización y rollback de nuestra aplicación</h4>
  <iframe width="560" height="315" src="https://www.youtube.com/embed/xY7W2e1ufWk" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
</section>
</section>
<section>
  <section>
    <h4>Despliegue de aplicaciones Python en OpenShift</h4>
    <ol>
      <li>Guardamos nuestra aplicación en un repositorio GitHub.</li>
      <li>Al crear nuestra aplicación, escogemos en el catálogo la opción de imagen <strong>python</strong>.</li>
      <li>Escogemos la versión de python e indicamos el repositorio de nuestra aplicación.</li>
      <li>Durante el despliegue se van a instalar los módulos que encuentre en el fichero requirements.txt</li>
      <li>El contenedor que vamos a crear ejecuta por defecto una aplicación qie se llame app.py</li>
    </ol>
  </section>
  <section>
    <h4>Despliegue de aplicaciones Python en OpenShift</h4>
    <iframe width="560" height="315" src="https://www.youtube.com/embed/6CjMm7iLdsE" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
  </section>
  </section>
    
  <section>
    <section>
      <h4>Despliegue de aplicaciones PHP en OpenShift</h4>
      <ol>
        <li>Vamos a instalar un CMS PHP que utiliza una base de datos Sqlite. (
          phpSQLiteCMS)</li>
        <li><a href="https://github.com/ilosuna/phpsqlitecms.git">Repositorio GitHub</a></li>
        <li>Al crear nuestra aplicación, escogemos en el catálogo la opción de imagen <strong>PHP</strong>.</li>
        <li>Escogemos la versión de PHP e indicamos el repositorio de nuestra aplicación.</li>
        <li>Durante el despliegue se van a instalar los módulos que encuentre en el fichero composer.json</li>
      </ol>
    </section>
    <section>
      <h4>Despliegue de aplicaciones PHP en OpenShift</h4>
      <ol>
        <li>En el directorio /cms/data se encuentran las bases de datos de la aplicación.</li>
        <li>Los contenedores son <strong>efímeros</strong>, no tenemos almacenamiento persistente.</li>
        <li>Cuando escalemos nuestra aplicación se va a crear otro pod con la base de datos inicial, en este nuevo pod no tenemos el mismo contenido que el original.</li>
        <li>Si realizamos un nuevo despliegue los nuevos pods perderán los datos de la base de datos.</li>
        <li><strong>¡¡¡Necesitamos volúmenes persistentes!!!</strong></li>
      </ol>
    </section>
    <section>
      <h4>Despliegue de aplicaciones PHP en OpenShift</h4>
      <iframe width="560" height="315" src="https://www.youtube.com/embed/loV8Iglhp30" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
    </section>
    </section>
<section>
    <section>
      <h4>Despliegue de aplicaciones PHP en OpenShift con almacenamiento persistente</h4>
      <ol>
        <li>El directorio donde se almacenan las bases de datos es /cms/data</li>
        <li>Nosotros vamos a crear un volumen persistente y lo vamos a montar en ese directorio.</li>
        <li>En el primer despliegue que creemos vamos a copiar al volumen persistente las bases de datos inicializadas.</li>
        <li>Para ello vamos a hacer un fork del repositorio y vamos a guardar en un directorio las bases de datos, para posteriormente poder copiarlas al volumen.</li>
      </ol>
    </section>
    <section>
      <h4>Despliegue de aplicaciones PHP en OpenShift con almacenamiento persistente</h4>
      <iframe width="560" height="315" src="https://www.youtube.com/embed/z8zkktHbcac" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
    </section>
  </section>
